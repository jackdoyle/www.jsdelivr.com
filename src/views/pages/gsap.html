<link rel="ractive" href="../r-page.html">
<link rel="ractive" href="../components/notification.html" name="c-notification">
<link rel="ractive" href="../components/gsap-package-sidemenu.html" name="c-gsap-package-sidemenu">

<r-page noYield="{{noYield}}" title="{{title}}" description="{{description}}" noFooter="true">
	<c-notification></c-notification>

	<div class="p-gsap">
		<div class="header">
			<a class="main-logo" href="/">
				<img width="140" height="34" src="{{@shared.assetsHost}}/img/jsdelivr-horizontal-full-white.svg">
			</a>
			<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/docs/v3/Installation#CDN" class="header-btn">
				<img width="20" height="20" src="{{@shared.assetsHost}}/img/icons/greensock.svg">
				Greensock CDN
			</a>
			<a href="/" class="header-link">jsdelivr</a>
			<a target="_blank" rel="noopener noreferrer" href="https://greensock.com" class="header-link">GreenSock.com</a>
			<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/docs" class="header-link">GSAP Docs</a>
			<a target="_blank" rel="noopener noreferrer" href="https://github.com/greensock" class="header-link">Github Project</a>
		</div>

		<div class="jumbotron-wrapper">
			<div class="jumbotron">
				<h1 class="title">GSAP</h1>
				
				<div class="description">
					<p>Boost your animation superpowers with 
						<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/docs/v3/GSAP" class="links">GSAP</a> 
						(GreenSock Animation Platform) - The industry standard for JavaScript animation.
					</p>

					<p>Use the core library to animate anything with ease: HTML DOM, SVG, canvas, WebGL, React, Vue. Leverage any of the 20+ 
						<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/gsap-plugins" class="links">Plugins</a> 
						like 
						<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/scrolltrigger" class="links">ScrollTrigger</a> 
						for even more control.
					</p>

					<p>GSAP has zero dependencies and works in every major browser; we obsess over performance and compatibility so you can focus on the fun stuff.</p>
					<p>Visit our 
						<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/docs" class="links">docs</a> 
						and 
						<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/forums" class="links">forums</a> 
						to learn more.
					</p>
				</div>

				<img width="279" height="484px" src="{{@shared.assetsHost}}/img/gsap/boxes.svg" class="boxes">
			</div>
		</div>

		<div class="content-wrapper">
			<div class="main-content">
				<div class="title">Quick Start with GSAP CDN</div>
				<div class="description">Get your production ready CDN links below. If you want your versions to be auto-upgraded then use
					the dropdown below to select the method. "Minor" is recommended.
				</div>

				<div class="files-table-wrapper">
					<div class="ctrls">
						<div class="ctrl">
							<span>Version:</span>

							<div class="btn-group">
								<button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<span>{{versionsList[versionIdx]}}</span>
									<i class="fa fa-angle-down" aria-hidden="true"></i>
								</button>

								<ul class="dropdown-menu versions-menu">
									{{#each versionsList:idx}}
										<li>
											<a on-click="@this.set('versionIdx', idx)" class="{{#if idx === versionIdx}}current{{/if}}">
												{{this}}
											</a>
										</li>
									{{/each}}
								</ul>
							</div>
						</div>

						<div class="ctrl">
							<span>Aliasing:</span>

							<div class="btn-group">
								<button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<span>{{aliasingList[aliasingIdx]}}</span>
									<i class="fa fa-angle-down" aria-hidden="true"></i>
								</button>

								<ul class="dropdown-menu">
									{{#each aliasingList:idx}}
										<li>
											<a on-click="@this.set('aliasingIdx', idx)" class="{{#if idx === aliasingIdx}}current{{/if}}">
												{{this}} {{@this.createAliasing(this, versionsList[versionIdx], true)}}
											</a>
										</li>
									{{/each}}
								</ul>
							</div>
						</div>
					</div>

					<div class="divider"></div>

					<div class="files-table">
						<div class="files-item">
							<div class="title">GSAP (core)</div>
							<div class="block-core">
								{{#if coreFile}}
									<span>
										{{@this.createUrl(coreFile, showESMFiles, true)}}
									</span>

									<div class="data-type-ctrl">
										<input id="type-switch"
											type="checkbox"
											class="data-type-switch {{#if showESMFiles}}checked{{/if}}"
											twoway="false">

										<label for="type-switch" on-click="@this.set('showESMFiles', !showESMFiles)">
											<span>UMD</span>
											<span>ESM</span>
										</label>
									</div>

									<a as-clipboard="'Copy URL to clipboard', 'right'"
										data-clipboard-text="{{@this.createUrl(coreFile, showESMFiles, true)}}">
										<img width="20" height="20" src="{{@shared.assetsHost}}/img/icons/copy-btn-black.svg">
									</a>
								{{/if}}
							</div>
						</div>

						{{#each filesData:key}}
							<div class="files-item">
								<div class="title">{{key}}</div>
								<div class="block">
									{{#if this}}
										<span>
											{{@this.createUrl(this, showESMFiles)}}
										</span>

										<a as-clipboard="'Copy URL to clipboard', 'right'"
											data-clipboard-text="{{@this.createUrl(this, showESMFiles)}}">
												<img width="20" height="20" src="{{@shared.assetsHost}}/img/icons/copy-btn-black.svg">
										</a>
									{{/if}}
								</div>
							</div>
						{{/each}}
					</div>

					<div class="plugins">
						<p class="plugins-descr">
							Other plugins like 
							<span class="plugin-badge">CustomBounce</span>, 
							<span class="plugin-badge">CustomWiggle</span>, 
							<span class="plugin-badge">DrawSVGPlugin</span>, 
							<span class="plugin-badge">GSDevTools</span>, 
							<span class="plugin-badge">InertiaPlugin</span>, 
							<span class="plugin-badge">MorphSVGPlugin</span>, 
							<span class="plugin-badge">MotionPathHelper</span>,
							<span class="plugin-badge">Physics2DPlugin</span>,
							<span class="plugin-badge">PhysicsPropsPlugin</span>,
							<span class="plugin-badge">ScrambleTextPlugin</span>,
							<span class="plugin-badge">ScrambleTextPlugin</span>
							and more are membership benefits of 
							<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/club" class="plugin-link">Club GreenSock</a>.
						</p>

						<p class="plugins-descr">
							To get trial versions that only work on CodePen.io, CodeSandbox.io, and locally, see 
							<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/try-plugins" class="plugin-link">https://greensock.com/try-plugins</a>.
							To get the unrestricted files, sign up at 
							<a target="_blank" rel="noopener noreferrer" href="https://greensock.com/club" class="plugin-link">https://greensock.com/club</a>
						</p>

					</div>
				</div>
			</div>
	
			<div class="side-content">
				<c-gsap-package-sidemenu
					name="{{packageName}}"
					type="{{packageType}}">
				</c-gsap-package-sidemenu>
			</div>
		</div>

		<div class="footer-wrapper">
			<div class="footer">
				<img class="footer-logo" width="140" height="34" src="{{@shared.assetsHost}}/img/jsdelivr-horizontal-regular.svg">
				<div class="powered">
					<span>Powered by <a href="/" class="footer-link">jsDelivr</a></span>
					<span>
						and sponsored by 
						<a target="_blank" rel="noopener noreferrer" href="https://www.cloudflare.com" class="footer-link">Cloudflare</a>, 
						<a target="_blank" rel="noopener noreferrer" href="https://appfleet.com" class="footer-link">appfleet</a>, 
						<a target="_blank" rel="noopener noreferrer" href="https://www.fastly.com" class="footer-link">Fastly</a>, 
						<a target="_blank" rel="noopener noreferrer" href="https://ns1.com" class="footer-link">NS1</a>
						 & 
						<a target="_blank" rel="noopener noreferrer" href="https://bunny.net" class="footer-link">bunny.net</a>
					</span>
				</div>

				<div class="nav">
					<a href="/about" class="footer-link">About</a>
					<a href="/terms" class="footer-link">Privacy Policy</a>
				</div>
			</div>
		</div>
	</div>
</r-page>

<script>
	const clipboard = require('../../public/js/decorators/clipboard');
	const http = require('../../public/js/utils/http');

	component.exports = {
		data () {
			return {
				packageName: 'gsap',
				packageType: 'npm',
				showESMFiles: false,
				aliasingList: [
					'Static',
					'Minor',
					'Major',
					'Latest',
				],
				versionIdx: 0,
				aliasingIdx: 1,
				versionsList: [],
				filesData: {
					CSSRulePlugin: '',
					Draggable: '',
					EasePack: '',
					EaselPlugin: '',
					MotionPathPlugin: '',
					PixiPlugin: '',
					ScrollToPlugin: '',
					ScrollTrigger: '',
					TextPlugin: '',
				},
			};
		},
		oninit () {
			if (!Ractive.isServer) {
				// get versions
				http.fetchPackageVersions(this.get('packageType'), this.get('packageName')).then((data) => {
					this.set('versionsList', data.versions);
				}).catch((error) => {
					console.error(`Gsap versions not found.`, error);
				});

				this.observe('versionIdx versionsList', () => {
					let version = this.get('versionsList')[this.get('versionIdx')];

					if (!version) { return; }

					// get core file of GSAP package
					http.fetchPackageEntrypoints(this.get('packageType'), this.get('packageName'), version).then((data) => {
						this.set('coreFile', data.js.file);
					});

					// get the rest of files of GSAP package
					http.fetchPackageFiles(this.get('packageType'), this.get('packageName'), version).then((data) => {
						let distFiles = [];
						let filesData = this.get('filesData');

						// get /dist files, filter for .min.js only
						for (let key in data.files) {
							if (data.files[key].name === 'dist') {
								distFiles = data.files[key].files.filter((file) => {
									return file.name.endsWith('.min.js');
								});

								break;
							}
						}

						// get all existing file paths
						Object.keys(filesData).forEach((fileName) => {
							for (let key in distFiles) {
								if (distFiles[key].name.includes(fileName)) {
									filesData[fileName] = distFiles[key].name;
									break;
								}
							}
						});

						this.set('filesData', filesData);
					});
				});
			}
		},
		createAliasing (aliasingBase, version, full = false) {
			let versionSplitted = version.split('.');
			let prepVersionBase = '';
			let prepVersionPart = '';

			switch (aliasingBase) {
				case 'Minor':
					prepVersionBase = `${versionSplitted[0]}.${versionSplitted[1]}`;
					prepVersionPart = '.x';
					break;
				case 'Static':
					prepVersionBase = version;
					break;
				case 'Major':
					prepVersionBase = versionSplitted[0];
					prepVersionPart = '.x.x';
					break;
			}

			if (full) {
				return prepVersionBase ? `(${prepVersionBase}${prepVersionPart})` : '';
			}

			return prepVersionBase ? prepVersionBase : 'latest';
		},
		createUrl (filePath, isEsm, isCore = false) {
			let packageName = this.get('packageName');
			let packageType = this.get('packageType');
			let version = this.get('versionsList')[this.get('versionIdx')];
			let aliasing = this.get('aliasingList')[this.get('aliasingIdx')];

			if (!version || !filePath) { return; }

			let URLbase = `https://cdn.jsdelivr.net/${packageType}/${packageName}@${this.createAliasing(aliasing, version)}`;

			if (isCore && isEsm) {
				return `${URLbase}/+esm`;
			} else if (isCore && !isEsm) {
				return `${URLbase}${filePath}`;
			} else if (!isCore && isEsm) {
				return `${URLbase}/dist/${filePath}/+esm`;
			}

			return `${URLbase}/dist/${filePath}`;
		},
		decorators: {
			clipboard,
		},
	};
</script>
